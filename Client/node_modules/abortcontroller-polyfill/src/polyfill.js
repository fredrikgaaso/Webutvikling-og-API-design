import AbortController, { AbortSignal } from 'abortcontroller-polyfill/dist/abortcontroller';
import abortableFetch from 'abortcontroller-polyfill/src/abortableFetch';
import { polyfillNeeded } from 'abortcontroller-polyfill/src/utils';

(function (self) {
  'use strict';

  if (!polyfillNeeded(self)) {
    return;
  }

  if (!self.fetch) {
    console.warn('fetch() is not available, cannot install abortcontroller-polyfill');
    return;
  }

  const { fetch, Request } = abortableFetch(self);
  self.fetch = fetch;
  self.Request = Request;

  Object.defineProperty(self, 'AbortController', {
    writable: true,
    enumerable: false,
    configurable: true,
    value: AbortController,
  });

  Object.defineProperty(self, 'AbortSignal', {
    writable: true,
    enumerable: false,
    configurable: true,
    value: AbortSignal,
  });
})(typeof self !== 'undefined' ? self : global);
